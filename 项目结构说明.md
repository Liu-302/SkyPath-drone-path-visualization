# 项目结构说明

## 概述

本项目采用 **Feature-Based 架构**（特性驱动设计），按照业务功能模块而不是技术类型来组织代码。

## 目录结构

```
src/
├── features/                    # 业务功能模块
│   ├── upload/                 # 上传功能模块
│   ├── kpi/                    # KPI分析模块
│   ├── visualization/          # 3D可视化模块
│   └── shared/                 # 共享功能模块
│
├── shared/                     # 全局共享资源
│   ├── utils/                  # 通用工具函数
│   ├── constants/              # 全局常量
│   ├── services/               # 全局服务
│   └── types/                  # 全局类型
│
├── pages/                      # 页面路由
│   ├── index.vue
│   ├── Upload.vue
│   └── Visualize.vue
│
├── stores/                     # Pinia状态管理
│   ├── dataset.ts
│   └── kpi.ts
│
└── styles/                     # 全局样式
    └── theme.css
```

## 各模块说明

### 1. features/upload - 上传功能模块
负责文件上传、模型加载、进度显示等功能。

**组件：**
- `DroneLoading.vue` - 加载动画
- `FileUploadZone.vue` - 文件上传区
- `ParticleBackground.vue` - 粒子背景

**逻辑：**
- `useFileUpload.ts` - 文件上传逻辑
- `useLoadingProgress.ts` - 加载进度
- `useModelLoader.ts` - 模型加载

### 2. features/kpi - KPI分析模块
负责KPI指标计算、显示和分析。

**组件：**
- `KPIPanel.vue` - KPI主面板
- `KPIHeader.vue` - KPI面板头部
- `MissionOverview.vue` - 任务概览
- `WaypointDetails.vue` - 航点详情
- `ViewpointDetails.vue` - 视点详情
- `SafetyDetails.vue` - 安全详情
- `CalculationStatus.vue` - 计算状态

**逻辑：**
- `useKpiCalculation.ts` - KPI计算
- `useKpiPlayback.ts` - KPI回放
- `useWaypointSelection.ts` - 航点选择
- `useWaypointDetails.ts` - 航点详情
- `useFlightSummary.ts` - 飞行概览

**服务：**
- `kpi-calculator.ts` - KPI主计算服务
- `energy-calculator.ts` - 能耗计算
- `coverage-calculator.ts` - 覆盖率计算
- `collision-detector.ts` - 碰撞检测

### 3. features/visualization - 3D可视化模块
负责3D场景渲染、相机控制、路径显示等。

**组件：**
- `CameraFrustum.vue` - 相机视锥体
- `BuildingHighlighter.vue` - 建筑高亮
- `VisualizeControlPanel.vue` - 可视化控制面板

**逻辑：**
- `useCameraController.ts` - 相机控制
- `usePathRenderer.ts` - 路径渲染
- `useViewpoints.ts` - 视点管理

**服务：**
- `viewpoint-calculator.ts` - 视点计算
- `path-parser.service.ts` - 路径解析

### 4. features/shared - 共享功能模块
跨模块使用的共享组件和逻辑。

**组件：**
- `ConfirmDialog.vue` - 确认对话框

**逻辑：**
- `useConfirmDialog.ts` - 对话框逻辑

### 5. shared - 全局共享资源
所有模块都可能用到的通用资源。

**工具函数：**
- `camera-utils.ts` - 相机相关工具函数
- `geometry.ts` - 几何计算工具函数

**常量：**
- `constants.ts` - 相机配置、能耗配置等

## Import 路径规范

```typescript
// 导入组件
import KPIPanel from '@/features/kpi/components/KPIPanel.vue'

// 导入 composable
import { useKpiCalculation } from '@/features/kpi/composables/useKpiCalculation'

// 导入服务
import { calculateAllKPIs } from '@/features/kpi/services/kpi-calculator'

// 导入类型
import type { KPIMetrics } from '@/features/kpi/types/kpi'

// 导入全局工具
import { distance3D } from '@/shared/utils/geometry'

// 导入全局常量
import { CAMERA_CONFIG } from '@/shared/constants/constants'
```

## 优势

1. **高内聚，低耦合** - 每个功能模块的所有相关代码都在一个文件夹内
2. **便于团队协作** - 不同成员可以独立负责不同的模块
3. **易于测试** - 每个模块可以独立测试
4. **新人友好** - 查看某个功能，直接进入对应的feature文件夹
5. **便于维护** - 功能增强或删除时，范围明确

## 修改指南

当你需要修改某个功能时：
1. 找到对应的 feature 模块（如 `features/kpi/`）
2. 在该模块内找到需要修改的文件
3. 修改时注意保持模块内的依赖关系清晰

当你需要添加新功能时：
1. 在 `features/` 下创建新的模块目录
2. 按照标准结构创建 `components/`、`composables/`、`services/`、`types/` 子目录
3. 在对应页面中导入使用
